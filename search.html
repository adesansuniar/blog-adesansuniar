---
layout: default
title: Pencarian
---

<div class="search-section">
  <input type="text" id="searchBox" placeholder="Cari judul atau isi..." />
  <div id="searchResults"></div>

  <hr />
  <h3>📅 Arsip Bulanan</h3>
  <ul id="monthlyArchive"></ul>

  <hr />
  <h3>📁 Kategori</h3>
  <ul id="categoryList"></ul>
</div>

<script src="/assets/js/search-mini.js"></script>
<script>
  fetch('/search-mini.json')
    .then(response => response.json())
    .then(posts => {
      const searchBox = document.getElementById('searchBox');
      const searchResults = document.getElementById('searchResults');
      const monthlyArchive = document.getElementById('monthlyArchive');
      const categoryList = document.getElementById('categoryList');

      // --- 🔍 PENCARIAN LIVE ---
      searchBox.addEventListener('input', function () {
        const keyword = this.value.toLowerCase();
        const filtered = posts.filter(post =>
          post.title.toLowerCase().includes(keyword) ||
          post.excerpt.toLowerCase().includes(keyword)
        );
        renderResults(filtered);
      });

      // --- 📅 ARSIP BULANAN ---
      const archiveMap = {};
      posts.forEach(post => {
        const dateObj = new Date(post.iso_date);
        const key = dateObj.toLocaleString('id-ID', { month: 'long', year: 'numeric' });
        if (!archiveMap[key]) archiveMap[key] = [];
        archiveMap[key].push(post);
      });

      Object.keys(archiveMap).sort((a, b) => {
        return new Date(archiveMap[b][0].iso_date) - new Date(archiveMap[a][0].iso_date);
      }).forEach(label => {
        const item = document.createElement('li');
        item.innerHTML = `<a href="#" data-archive="${label}">${label} (${archiveMap[label].length})</a>`;
        monthlyArchive.appendChild(item);
      });

      monthlyArchive.addEventListener('click', function (e) {
        if (e.target.tagName === 'A') {
          e.preventDefault();
          const filtered = archiveMap[e.target.dataset.archive];
          renderResults(filtered);
        }
      });

      // --- 📁 KATEGORI ---
      const categoryMap = {};
      posts.forEach(post => {
        if (post.category) {
          const categories = Array.isArray(post.category) ? post.category : [post.category];
          categories.forEach(cat => {
            if (!categoryMap[cat]) categoryMap[cat] = [];
            categoryMap[cat].push(post);
          });
        }
      });

      Object.keys(categoryMap).sort().forEach(cat => {
        const item = document.createElement('li');
        item.innerHTML = `<a href="#" data-cat="${cat}">${cat} (${categoryMap[cat].length})</a>`;
        categoryList.appendChild(item);
      });

      categoryList.addEventListener('click', function (e) {
        if (e.target.tagName === 'A') {
          e.preventDefault();
          const filtered = categoryMap[e.target.dataset.cat];
          renderResults(filtered);
        }
      });

      // --- 🖥️ RENDER HASIL ---
      function renderResults(list) {
        searchResults.innerHTML = list.map(post => `
          <div class="search-item">
            <h3><a href="${post.url}">${post.title}</a></h3>
            <small>${post.formatted_date}</small>
            <p>${post.excerpt}</p>
          </div>
        `).join('');
      }
    });
</script>
